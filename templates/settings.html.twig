{% extends 'base.html.twig' %}

{% block title %}–ù–∞—Å—Ç—Ä–æ–π–∫–∏ - Bybit Trader{% endblock %}

{% block scripts %}
<script src="/assets/js/settings.js"></script>
{% endblock %}

{% block content %}
<div class="settings">
    <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
    
    <div class="settings-section">
        <h3>Bybit API</h3>
        <form id="bybit-settings-form">
            <div class="form-group">
                <label>API Key:</label>
                <input type="text" id="bybit-api-key" name="api_key" placeholder="–í–≤–µ–¥–∏—Ç–µ API Key">
            </div>
            <div class="form-group">
                <label>API Secret:</label>
                <input type="password" id="bybit-api-secret" name="api_secret" placeholder="–í–≤–µ–¥–∏—Ç–µ API Secret">
            </div>
            <div class="form-group">
                <label>Testnet:</label>
                <input type="checkbox" id="bybit-testnet" name="testnet" checked>
                <span>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Å–µ—Ç—å</span>
            </div>
            <div class="form-group">
                <label>Base URL:</label>
                <input type="text" id="bybit-base-url" name="base_url" placeholder="https://api-testnet.bybit.com">
            </div>
            <div class="buttons-row">
                <button type="submit" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button type="button" id="bybit-test-btn" class="btn-secondary">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</button>
            </div>
        </form>
    </div>

    <div class="settings-section">
        <h3>ChatGPT API</h3>
        <form id="chatgpt-settings-form">
            <div class="form-group">
                <label>API Key:</label>
                <input type="text" id="chatgpt-api-key" name="api_key" placeholder="–í–≤–µ–¥–∏—Ç–µ OpenAI API Key">
            </div>
            <div class="form-group">
                <label>–ú–æ–¥–µ–ª—å:</label>
                <select id="chatgpt-model" name="model">
                    <option value="gpt-4">GPT-4</option>
                    <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                </select>
            </div>
            <div class="form-group">
                <label>–í–∫–ª—é—á–µ–Ω–æ:</label>
                <input type="checkbox" id="chatgpt-enabled" name="enabled">
                <span>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ChatGPT –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</span>
            </div>
            <div class="buttons-row">
                <button type="submit" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button type="button" id="chatgpt-test-btn" class="btn-secondary">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</button>
            </div>
        </form>
    </div>

    <div class="settings-section">
        <h3>DeepSeek API (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π LLM)</h3>
        <form id="deepseek-settings-form">
            <div class="form-group">
                <label>API Key:</label>
                <input type="text" id="deepseek-api-key" name="api_key" placeholder="–í–≤–µ–¥–∏—Ç–µ DeepSeek API Key">
            </div>
            <div class="form-group">
                <label>–ú–æ–¥–µ–ª—å:</label>
                <select id="deepseek-model" name="model">
                    <option value="deepseek-chat">deepseek-chat</option>
                    <option value="deepseek-reasoner">deepseek-reasoner</option>
                </select>
            </div>
            <div class="form-group">
                <label>–í–∫–ª—é—á–µ–Ω–æ:</label>
                <input type="checkbox" id="deepseek-enabled" name="enabled">
                <span>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DeepSeek, –µ—Å–ª–∏ ChatGPT –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</span>
            </div>
            <div class="buttons-row">
                <button type="submit" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button type="button" id="deepseek-test-btn" class="btn-secondary">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</button>
            </div>
        </form>
    </div>

    <div class="settings-section">
        <h3>–¢–æ—Ä–≥–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h3>
        <form id="trading-settings-form">
            <div class="form-group">
                <label>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Å–¥–µ–ª–∫–∏ (USDT):</label>
                <input type="number" step="0.01" min="0" id="trading-max-position" name="max_position_usdt" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 100">
            </div>
            <div class="form-group">
                <label>–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø–ª–µ—á–æ:</label>
                <input type="number" min="1" id="trading-min-leverage" name="min_leverage" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 1">
            </div>
            <div class="form-group">
                <label>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –ø–ª–µ—á–æ:</label>
                <input type="number" min="1" id="trading-max-leverage" name="max_leverage" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 5">
            </div>
            <div class="form-group">
                <label>–ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ—Å—Ç—å:</label>
                <select id="trading-aggressiveness" name="aggressiveness">
                    <option value="conservative">–ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–∞—è</option>
                    <option value="balanced">–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è</option>
                    <option value="aggressive">–ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è</option>
                </select>
            </div>
            <div class="form-group">
                <label>–ú–∞–∫—Å–∏–º—É–º –ø–æ–∑–∏—Ü–∏–π –ø–æ–¥ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –±–æ—Ç–∞:</label>
                <input type="number" min="1" id="trading-max-managed" name="max_managed_positions" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 10">
            </div>
            <div class="form-group">
                <label>–ú–∏–Ω–∏–º—É–º –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π –¥–ª—è –∞–≤—Ç–æ–æ—Ç–∫—Ä—ã—Ç–∏—è –±–æ—Ç–æ–º:</label>
                <input type="number" min="0" id="trading-auto-open-min" name="auto_open_min_positions" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 5">
            </div>
            <div class="form-group">
                <label>–ê–≤—Ç–æ–æ—Ç–∫—Ä—ã—Ç–∏–µ —Å–¥–µ–ª–æ–∫ –±–æ—Ç–æ–º:</label>
                <input type="checkbox" id="trading-auto-open-enabled" name="auto_open_enabled">
                <span>–†–∞–∑—Ä–µ—à–∏—Ç—å –±–æ—Ç—É —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å —Å–¥–µ–ª–∫–∏, –µ—Å–ª–∏ –ø–æ–∑–∏—Ü–∏–π –º–µ–Ω—å—à–µ –ø–æ—Ä–æ–≥–∞</span>
            </div>
            <div class="form-group">
                <label>–¢–∞–π–º—Ñ—Ä–µ–π–º –±–æ—Ç–∞ (—á–∞—Å—Ç–æ—Ç–∞ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π):</label>
                <select id="trading-bot-timeframe" name="bot_timeframe">
                    <option value="1">1 –º–∏–Ω (—Å–∫–∞–ª—å–ø–∏–Ω–≥)</option>
                    <option value="5">5 –º–∏–Ω</option>
                    <option value="15">15 –º–∏–Ω</option>
                    <option value="30">30 –º–∏–Ω</option>
                    <option value="60">1 —á–∞—Å</option>
                    <option value="240">4 —á–∞—Å–∞</option>
                    <option value="1440">1 –¥–µ–Ω—å</option>
                </select>
                <span class="hint">–ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É, –Ω–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥. –ò—Å—Ç–æ—Ä–∏—è —Ü–µ–Ω —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –ø–æ –≤—Å–µ–º —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.</span>
            </div>
            <div class="form-group">
                <label>–°–≤–µ—á–µ–π –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ (–º–∞–∫—Å. 60):</label>
                <input type="number" min="5" max="60" id="trading-history-candles" name="bot_history_candles" placeholder="60">
                <span class="hint">–°–∫–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–≤–µ—á–µ–π –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –±–æ—Ç—É –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∞–Ω–∞–ª–∏–∑–µ.</span>
            </div>
            <div class="buttons-row">
                <button type="submit" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </form>
    </div>

    <div class="settings-section" style="border-color: #f85149;">
        <h3 style="color: #f85149;">‚ö° –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Ç–µ—Ä—å (Risk Guards)</h3>
        <form id="risk-settings-form">
            <div class="form-group">
                <label>–¢–æ—Ä–≥–æ–≤–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∞:</label>
                <input type="checkbox" id="risk-trading-enabled" name="trading_enabled" checked>
                <span>–°–Ω–∏–º–∏—Ç–µ –≥–∞–ª–æ—á–∫—É, —á—Ç–æ–±—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –í–°–ï —Ç–æ—Ä–≥–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –±–æ—Ç–∞ –∏ —Ä—É—á–Ω–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ.</span>
            </div>
            <div class="form-group">
                <label>–î–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç –ø–æ—Ç–µ—Ä—å (USDT):</label>
                <input type="number" step="0.01" min="0" id="risk-daily-loss" name="daily_loss_limit_usdt" placeholder="0 = –æ—Ç–∫–ª—é—á–µ–Ω–æ">
                <span class="hint">–ï—Å–ª–∏ —Å—É–º–º–∞—Ä–Ω—ã–π PnL –∑–∞ –¥–µ–Ω—å –æ–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∏–∂–µ ‚àíX USDT, –±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è. 0 ‚Äî –ª–∏–º–∏—Ç –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.</span>
            </div>
            <div class="form-group">
                <label>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Å—É–º–º–∞—Ä–Ω—ã–π —Ä–∏—Å–∫ (USDT –º–∞—Ä–∂–∏):</label>
                <input type="number" step="0.01" min="0" id="risk-max-exposure" name="max_total_exposure_usdt" placeholder="0 = –æ—Ç–∫–ª—é—á–µ–Ω–æ">
                <span class="hint">–°—É–º–º–∞ –≤—Å–µ—Ö –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω—ã—Ö –∑–∞–ª–æ–≥–æ–≤ (notional/leverage). –ï—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∞ ‚Äî –Ω–æ–≤—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è. 0 ‚Äî –ª–∏–º–∏—Ç –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.</span>
            </div>
            <div class="form-group">
                <label>–ö—É–ª–¥–∞—É–Ω –º–µ–∂–¥—É –¥–µ–π—Å—Ç–≤–∏—è–º–∏ –ø–æ —Å–∏–º–≤–æ–ª—É (–º–∏–Ω):</label>
                <input type="number" min="0" id="risk-cooldown" name="action_cooldown_minutes" placeholder="30">
                <span class="hint">–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É —Ç–æ—Ä–≥–æ–≤—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏ –ø–æ –æ–¥–Ω–æ–π –∏ —Ç–æ–π –∂–µ –º–æ–Ω–µ—Ç–µ. 0 ‚Äî –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.</span>
            </div>
            <div class="form-group">
                <label>–°—Ç—Ä–æ–≥–∏–π —Ä–µ–∂–∏–º (–¥–≤—É—Ö—Ñ–∞–∑–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ):</label>
                <input type="checkbox" id="risk-strict-mode" name="bot_strict_mode">
                <span>CLOSE_FULL –∏ AVERAGE_IN —Ç—Ä–µ–±—É—é—Ç —Ä—É—á–Ω–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è. –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫ –±–æ—Ç—É.</span>
            </div>
            <div class="buttons-row">
                <button type="submit" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </form>
    </div>

    <div class="settings-section" style="border-color: #58a6ff;">
        <h3 style="color: #58a6ff;">üîî –ê–ª–µ—Ä—Ç—ã (Telegram / Webhook)</h3>
        <p style="color:#8b949e;font-size:0.85rem;margin-bottom:14px;">
            –ü–æ–ª—É—á–∞–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–±–æ—è—Ö LLM, –æ—à–∏–±–∫–∞—Ö Bybit, –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤ —Ä–∏—Å–∫–∞.
        </p>
        <form id="alerts-settings-form">
            <div class="form-group">
                <label>Telegram Bot Token:</label>
                <input type="text" id="alerts-tg-token" name="telegram_bot_token" placeholder="123456:ABCdef...">
            </div>
            <div class="form-group">
                <label>Telegram Chat ID:</label>
                <input type="text" id="alerts-tg-chat" name="telegram_chat_id" placeholder="-1001234567890">
                <span class="hint">–£–∑–Ω–∞—Ç—å chat_id: –¥–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ /api/getUpdates</span>
            </div>
            <div class="form-group">
                <label>Webhook URL (Slack / Discord / Custom):</label>
                <input type="text" id="alerts-webhook" name="webhook_url" placeholder="https://hooks.slack.com/...">
            </div>
            <div class="form-group">
                <label>–£–≤–µ–¥–æ–º–ª—è—Ç—å –æ —Å–±–æ—è—Ö LLM:</label>
                <input type="checkbox" id="alerts-llm-failure" name="on_llm_failure" checked>
            </div>
            <div class="form-group">
                <label>–£–≤–µ–¥–æ–º–ª—è—Ç—å –æ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –æ—Ç–≤–µ—Ç–∞—Ö LLM:</label>
                <input type="checkbox" id="alerts-invalid-resp" name="on_invalid_response" checked>
            </div>
            <div class="form-group">
                <label>–£–≤–µ–¥–æ–º–ª—è—Ç—å –æ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤ —Ä–∏—Å–∫–∞:</label>
                <input type="checkbox" id="alerts-risk-limit" name="on_risk_limit" checked>
            </div>
            <div class="form-group">
                <label>–£–≤–µ–¥–æ–º–ª—è—Ç—å –æ–± –æ—à–∏–±–∫–∞—Ö Bybit API:</label>
                <input type="checkbox" id="alerts-bybit-error" name="on_bybit_error">
            </div>
            <div class="form-group">
                <label>–£–≤–µ–¥–æ–º–ª—è—Ç—å –æ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –æ—à–∏–±–∫–∞—Ö:</label>
                <input type="checkbox" id="alerts-repeated" name="on_repeated_failures" checked>
            </div>
            <div class="form-group">
                <label>–ü–æ—Ä–æ–≥ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –æ—à–∏–±–æ–∫ (–ø–æ–¥—Ä—è–¥):</label>
                <input type="number" min="1" id="alerts-threshold" name="repeated_failure_threshold" value="3">
            </div>
            <div class="buttons-row">
                <button type="submit" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button type="button" id="test-alert-btn" class="btn-secondary">–¢–µ—Å—Ç–æ–≤—ã–π –∞–ª–µ—Ä—Ç</button>
            </div>
        </form>
    </div>

    <div id="settings-message" class="message"></div>
</div>
{% endblock %}
